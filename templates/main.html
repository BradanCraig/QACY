<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QACY</title>
    <link rel="stylesheet" href="static/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Welcome To QACY!</h1>
            <h2>Where All of Your Mycelium Needs Are Met</h2>
        </header>
        <section class="intro">
            <p>This Machine Learning algorithm was created to help classify mycelium growth into 3 classes</p>
            <ul>
                <li style="color: Red">No Growth</li>
                <li style="color: Blue">Medium Growth</li>
                <li style="color: Green">High Growth</li>
            </ul>
            <p>Simply inserting an image of your growth will return a masked images</p>
            <p>If you would like to insert multiple images, zip them into a single folder and it will return a zipfile with the images inside</p>
        </section>
        <!--
        <section class="intro">
            <p>Please sit down and enjoy a nice cup of tea while we classify mycelium growth to help better the world.</p>
            <p>Rest assured that this is a very robust piece of software that Bradan wrote when he was definitely not tired, so we promise that it would never break.</p>
            <p>Look! You can even name your file!</p>
            <p>Now that is high level stuff right there</p>
            <p>Besides, when has Bradan ever written code that hasn't worked?</p>
            <p>However, in the rare circumstance that something doesn't work, please go to your terminal in VSCode, screenshot the error message, and send it to our help line.</p>
            <p><a href="discord://discord.com/users/1196300801539321877">Click Here</a> for easy access to that help line.</p>
            <p>Please include what you did that caused the error, and our IT team will get back to you within 3â€“5 business days. Or for a small fee of $5 we can get that response time down to 1 day!</p>
            <p>Anyway, enjoy QACY!</p>
        </section>
        -->
        <section class="upload">
            <label for="file">Upload zip file:</label>
            <input type="file" id="file">
            <input type="text", id="name", placeholder="Name Your Zip File Here", size="22">
            <button onclick="SubmitImages()">Submit</button>
        </section>
        <div id="spinner" class="spinner hidden"></div>
        <div id="results" hidden></div>
    </div>

    <script>
        async function SubmitImages(){
            const name = document.getElementById("name").value
            const fileInput = document.getElementById("file");
            const file = fileInput.files[0];

            const spinner = document.getElementById("spinner");
            spinner.classList.remove("hidden");
            
            const results = document.getElementById("results")
            results.innerHTML=''

            if (file == null){
                results.hidden=false
                results.innerHTML="<p>Please insert a photo</p>"
            }
            else{
            const formData = new FormData();
            formData.append("images", file);
            formData.append("name", name)

            try {
                await fetch("/infer", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const percents = data.percents

                    const byteCharacters = atob(data.zip_file)
                    const byteNumbers = Array.from(byteCharacters).map(char => char.charCodeAt(0));
                    const byteArray = new Uint8Array(byteNumbers);

                    const blob = new Blob([byteArray], {type: 'application.zip'});

                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");

                    a.href = url;
                    a.download = name + ".zip";
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);

                    spinner.classList.add("hidden");
                    
                    results.innerHTML = `<p>Average Percent Growth of Sample</p><ul><li>Low Growth: ${percents["low"]}</li> <li>Medium Growth: ${percents["medium"]}</li><li>High Growth: ${percents["high"]}</li> </ul>`
                    results.hidden = false
            })
            } catch (error) {
                console.error("Error:", error);
            }
            }
        }
    </script>
</body>
</html>
